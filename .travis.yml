services:
  - docker

language: rust
rust:
  - nightly
cache: cargo

jobs:
  include:
    - stage: build
      script: cargo build --verbose --release
    - stage: test
      script: cargo test --verbose --release
    - stage: docker image development
      if: branch = develop AND type = push
      script: cargo build --release && ./scripts/docker-image-release.sh develop
    - stage: binary release
      if: branch = master AND type = push
      script: ./scripts/binary-release.sh
    - stage: docker image release
      if: branch = master AND type = push
      script: ./scripts/docker-image-release.sh release